#include<stdio.h>
#include<string.h>
#include<stdlib.h>
struct students
{
    int id;
    char name[10];
    int course[10];
    int sorce;
    int show;
}stu[100];
int len;
void show_stu(int flag)
{
	int i,j;
	printf("%8s%8s%8s%8s\n","ID","NAME","SORCE","COURSE");
	if(flag == -1)
	{
		for(i=0;i<len;i++)
		{
			printf("%8d%8s%8d  ",stu[i].id,stu[i].name,stu[i].sorce);
			for(j=0;stu[i].course[j+1];j++)
				printf("%d,",stu[i].course[j]);
			printf("%d\n",stu[i].course[j]);
		}
	}
	else
	{
		printf("%8d%8s%8d  ",stu[flag].id,stu[flag].name,stu[flag].sorce);
		for(j=0;stu[flag].course[j+1];j++)
			printf("%d,",stu[flag].course[j]);
		printf("%d\n",stu[flag].course[j]);
	}
}
void loadin()
{
	int i=0,j,num=0,n=0;
	char course_tmp[30];
	FILE *fp;
	if((fp = fopen("student.txt","r"))==NULL)
	{
		printf("File error!\n");
		exit(0);
	}
	while(!feof(fp))
	{
		fscanf(fp,"%d%s%d%s",&stu[i].id,stu[i].name,&stu[i].sorce,course_tmp);	
		num=0;		
		for(j=0,n=0;course_tmp[j];j++)
		{
			if(course_tmp[j] == ',')
			{
				stu[i].course[n]=num;
				n++;
				num=0;
			}
			else
				num = num*10+(course_tmp[j]-48);
		}
		stu[i].course[n]=num;
		i++;
	}
	len=i-1;
	show_stu(-1);
	fclose(fp);
}
int add()
{
	int i=len;
	printf("please input student's id:");
	scanf("%d",&stu[i].id);
	printf("please input student's name:");
	scanf("%s",stu[i].name);
	printf("please input student's score:");
	scanf("%d",&stu[i].sorce);
	printf("please input student's course(enter 0 to end it):");
	int tmp,j=0;
	while(1)
	{
		scanf("%d",&tmp);
		if(tmp == 0)
			break;
		stu[i].course[j++]=tmp;
	}
	len++;
	show_stu(-1);
	FILE *fp_a;
	if((fp_a = fopen("student.txt","a+")) == NULL)
	{
		printf("File error!\n");
		exit(0);
	}
	fprintf(fp_a,"%d %s %d ",stu[i].id,stu[i].name,stu[i].sorce);
	for(j=0;stu[i].course[j+1];j++)
			fprintf(fp_a,"%d,",stu[i].course[j]);
	fprintf(fp_a,"%d\n",stu[i].course[j]);
	fclose(fp_a);
}
int change()
{
	int change_num,i;
	change_num=search();
	if(change_num == -2)
	{
		printf("\nNot exist!\n");
		return 0;
	}
	show_stu(change_num);
	printf("please input student's id:");
	scanf("%d",&stu[change_num].id);
	printf("please input student's name:");
	scanf("%s",stu[change_num].name);
	printf("please input student's score:");
	scanf("%d",&stu[change_num].sorce);
	printf("please input student's course(enter 0 to end it):");
	int tmp,j=0;
	while(1)
	{
		scanf("%d",&tmp);
		if(tmp == 0)
			break;
		stu[change_num].course[j++]=tmp;
	}
	show_stu(-1);
	FILE *fp_w;
	if((fp_w = fopen("student.txt","w")) == NULL)
	{
		printf("File error!\n");
		exit(0);
	}
	for(i=0;i<len;i++)
	{
		fprintf(fp_w,"%d %s %d ",stu[i].id,stu[i].name,stu[i].sorce);
		for(j=0;stu[i].course[j+1];j++)
			fprintf(fp_w,"%d,",stu[i].course[j]);
		fprintf(fp_w,"%d\n",stu[i].course[j]);
	}
	fclose(fp_w);
}
int delet()
{
	int delet_num,i,j;
	delet_num=search();
	if(delet_num == -2)
	{
		printf("\nNot exist!\n");
		return 0;
	}
	for(i=delet_num;i<len-1;i++)
	{
		stu[i]=stu[i+1];
	}
	len--;
	show_stu(-1);
	FILE *fp_w;
	if((fp_w = fopen("student.txt","w")) == NULL)
	{
		printf("File error!\n");
		exit(0);
	}
	for(i=0;i<len;i++)
	{
		fprintf(fp_w,"%d %s %d ",stu[i].id,stu[i].name,stu[i].sorce);
		for(j=0;stu[i].course[j+1];j++)
			fprintf(fp_w,"%d,",stu[i].course[j]);
		fprintf(fp_w,"%d\n",stu[i].course[j]);
	}
	fclose(fp_w);
	return 0;
}
int search()
{
	int select,i,j;
	printf("\n1.Search as student's ID\n");
	printf("\n2.Search as student's NAME\n");
	printf("\n3.Exit!\n");
	printf("\nPlease choose the function: ");
	scanf("%d",&select);
	char search_name[10];
	int search_id;
	if(select == 1)
	{
		printf("please input ID:");
		scanf("%d",&search_id);
		for(i=0;i<len;i++)
		{
			if(stu[i].id == search_id)
				return i;
		}
		return -2;
	}
	else if(select == 2)
	{
		printf("please input NAME:");
		scanf("%s",search_name);
		for(i=0;i<len;i++)
		{
			if(strcmp(stu[i].name,search_name) == 0)
				return i;
		}
		return -2;
	}
	else if(select == 3)
		return -1;
	else
		printf("Input error!\n");
}
int stu_info()
{
	int select,flag;
	loadin();
	while(select!=5)
	{
		printf("\n1.Add student's information\n");
		printf("\n2.Change student's information\n");
		printf("\n3.Delete student's information\n");
		printf("\n4.Search student's information\n");
		printf("\n5.Exit\n");
		printf("\nPlease choose the function: ");
		scanf("%d",&select);
		if(select == 1)
			add();
		else if(select == 2)
			change();
		else if(select == 3)
			delet();
		else if(select == 4)
		{
			flag=search();
			if(flag == -2)
				printf("\nNot exist!\n");
			else
				show_stu(flag);
		}
		else if(select>5 || select<1)
			printf("Input error! Please try again!\n");
	}
	return 0;
}
